<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Michel ‚Äì Oracle IA</title>
  <style>
    html, body {
      height: 100%; margin: 0;
      background: #0a2b38 url("oracle-bg.png") repeat center;
      background-size: 800px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: #fffbea;
      display: grid; place-items: center;
      overflow: hidden;
      text-align: center;
    }

    .container {
      position: relative;
      height: 90vh;
      width: min(64vw, 900px);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(4px);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,.4);
      display: grid;
      grid-template-rows: auto auto auto 1fr;
      gap: 8px;
      padding: 10px 14px;
      animation: float 6s ease-in-out infinite;
      overflow: hidden;
    }
    @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }

    h1 {
      margin: 0;
      font-size: clamp(1.6rem, 2.4vw, 2.2rem);
      text-shadow: 0 2px 8px rgba(0,0,0,.6);
    }

    .lang-toggle, .tts-toggle {
      margin: 0 auto;
      background: rgba(255,255,255,.18);
      color:#fff;
      border:none;
      border-radius:12px;
      padding:6px 12px;
      cursor:pointer;
      display:flex; gap:6px; align-items:center; justify-content:center;
      backdrop-filter: blur(6px);
      font-size:14px;
      transition: background 0.3s;
    }
    .tts-toggle[aria-pressed="true"] { background: rgba(64,255,154,.25); }
    .lang-toggle:hover, .tts-toggle:hover { background: rgba(255,255,255,.25); }

    .stage {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 14px; height: 100%; min-height: 0;
    }

    .michel {
      height: 100%; width: auto; max-width: 100%;
      object-fit: contain;
      filter: drop-shadow(0 0 15px rgba(0,0,0,.6));
      transition: transform .5s ease, filter .6s ease;
    }
    .michel.magic { transform: scale(1.05); filter: drop-shadow(0 0 18px gold) brightness(1.15); }

    .bubble {
      background: rgba(255,255,255,.16);
      border-radius: 15px;
      padding: 14px 18px;
      font-size: clamp(1rem, 2.2vw, 1.35rem);
      line-height: 1.35;
      max-width: 86%;
      box-shadow: inset 0 0 10px rgba(255,255,255,.2), 0 0 10px rgba(0,0,0,.3);
      text-shadow: 0 2px 4px rgba(0,0,0,.4);
      transition: transform .25s ease, opacity .25s ease;
    }
    .bubble.show { transform: scale(1.04); opacity: 1; }

    @media (max-width: 820px) { .container { width: 92vw; height: 88vh; } }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="title">üîÆ Michel ‚Äì Oracle IA</h1>

    <!-- üåê Switch Langue -->
    <button id="langToggle" class="lang-toggle">üåê Langue : Fran√ßais</button>

    <!-- üîä Bouton Voix -->
    <button id="ttsToggle" class="tts-toggle" aria-pressed="true" title="Activer/D√©sactiver la voix">
      <span id="ttsIcon">üîä</span><span id="ttsLabel">Voix activ√©e</span>
    </button>

    <div class="stage">
      <img id="michel" class="michel" src="michel.png" alt="Michel Oracle IA" />
      <div id="bubble" class="bubble" aria-live="polite">
        Pose ta question... puis touche l‚Äô√©cran ou appuie sur <strong>espace</strong> pour conna√Ætre ton destin ‚ú®
      </div>
    </div>
  </div>

  <script>
    /* ========= R√©pliques FUN (FR & EN) ========= */
    const answersFR = [
      "Oui, mais pas sans chocolat chaud.",
      "Non‚Ä¶ enfin, pas aujourd‚Äôhui.",
      "√áa sent le ¬´ peut-√™tre ¬ª tr√®s motiv√©.",
      "Les astres b√¢illent : essaye et regarde.",
      "Tout pointe vers un grand oui discret.",
      "Le timing est bon, la batterie un peu moins.",
      "Si tu souris, la r√©ponse penche vers oui.",
      "C‚Äôest non, mais avec panache.",
      "Tu n‚Äôas pas besoin de permission pour √ßa.",
      "Tu connais d√©j√† la r√©ponse (indice : elle te pla√Æt).",
      "Demande √† nouveau apr√®s un snack.",
      "Fais simple, et √ßa fonctionnera.",
      "C‚Äôest risqu√©, mais la l√©gende en vaut la peine.",
      "Mets des chaussettes chanceuses et fonce.",
      "Le doute est bruyant, l‚Äôenvie a raison.",
      "Oui‚Ä¶ mais sauvegarde d‚Äôabord.",
      "Non pour l‚Äôinstant. Recalibre et reviens.",
      "Essaie une petite version d√®s maintenant.",
      "Tu n‚Äôobtiendras pas mieux que ¬´ pourquoi pas ? ¬ª",
      "Le futur t‚Äôenverra un high five si tu y vas.",
      "Statistiquement oui, dramatiquement peut-√™tre.",
      "Fais-le comme si tu n‚Äôavais pas peur.",
      "Ton instinct a d√©j√† vot√©.",
      "Ajoute du caf√© : approbation automatique.",
      "Pose la bonne premi√®re petite pierre.",
      "Si c‚Äôest fun et utile, c‚Äôest oui.",
      "Tu n‚Äôes pas en retard, tu es en √©dition 2.0.",
      "Quand tu h√©sites : 20 minutes d‚Äôaction.",
      "Tu peux, mais choisis une deadline courte.",
      "Le Wi-Fi cosmique dit oui en 3 barres.",
      "Plan A, mais avec un plan B dans la poche.",
      "C‚Äôest non, sauf si tu danses. L√† c‚Äôest oui.",
      "Teste en mode brouillon, publie si √ßa sourit.",
      "La version future de toi te soutient.",
      "Le hasard aime ceux qui cliquent.",
      "Un pas aujourd‚Äôhui vaut dix promesses demain."
    ];

    const answersEN = [
      "Yes, but not without hot chocolate.",
      "No‚Ä¶ well, not today.",
      "It smells like a very motivated maybe.",
      "The stars yawn: try and see.",
      "Everything points to a quiet, confident yes.",
      "Timing is good, battery slightly low.",
      "If you smile, the answer leans yes.",
      "It‚Äôs a no‚Äîdelivered stylishly.",
      "You don‚Äôt need permission for this.",
      "You already know the answer (hint: you like it).",
      "Ask again after a snack.",
      "Keep it simple and it will work.",
      "It‚Äôs risky, but legend-worthy.",
      "Put on lucky socks and go.",
      "Doubt is loud, desire is right.",
      "Yes‚Ä¶ but save first.",
      "Not yet. Recalibrate and return.",
      "Try a tiny version right now.",
      "You won‚Äôt get better than ‚Äúwhy not?‚Äù.",
      "Future-you will high-five this.",
      "Statistically yes, dramatically maybe.",
      "Do it as if you weren‚Äôt afraid.",
      "Your gut already voted.",
      "Add coffee: auto-approval.",
      "Lay the right first small brick.",
      "If it‚Äôs fun and useful, it‚Äôs yes.",
      "You‚Äôre not late‚Äîyou‚Äôre v2.0.",
      "When in doubt: 20 minutes of action.",
      "You can, but pick a short deadline.",
      "Cosmic Wi-Fi says yes with three bars.",
      "Plan A‚Äîplus a pocket Plan B.",
      "It‚Äôs a no‚Äîunless you dance. Then yes.",
      "Ship it as draft; publish if it smiles.",
      "Future you is cheering.",
      "Luck likes people who click.",
      "One step today beats ten promises tomorrow."
    ];

    const instructions = {
      fr: "Pose ta question... puis touche l‚Äô√©cran ou appuie sur <strong>espace</strong> pour conna√Ætre ton destin ‚ú®",
      en: "Ask your question... then tap the screen or press <strong>space</strong> to reveal your fate ‚ú®"
    };

    /* ========= √âl√©ments ========= */
    const michel = document.getElementById("michel");
    const bubble = document.getElementById("bubble");
    const ttsToggle = document.getElementById("ttsToggle");
    const ttsIcon = document.getElementById("ttsIcon");
    const ttsLabel = document.getElementById("ttsLabel");
    const langToggle = document.getElementById("langToggle");
    const title = document.getElementById("title");

    /* ========= √âtats ========= */
    let ttsEnabled = JSON.parse(localStorage.getItem("michel_tts_enabled") ?? "true");
    let lang = localStorage.getItem("michel_lang") || "fr";

    updateLangUI();
    updateTtsUI();

    /* ========= Choix voix masculine selon langue ========= */
    function pickMaleVoice() {
      const voices = speechSynthesis.getVoices();
      const target = lang === "fr" ? "fr" : "en";
      const frHints = ["thomas","paul","nicolas","standard-b","wavenet-b","neural2-b","fr-fr"];
      const enHints = ["daniel","en-gb-standard-b","en-gb-wavenet-b","google uk english male","male","en-gb"];
      const hints = target === "fr" ? frHints : enHints;
      const cands = voices.filter(v => v.lang?.toLowerCase().startsWith(target));
      return cands.find(v => hints.some(h => (v.name+v.voiceURI).toLowerCase().includes(h))) || cands[0] || null;
    }

    /* ========= Nettoyage TTS (enl√®ve √©mojis & pictos) ========= */
    function sanitizeForTTS(text){
      let t = String(text);
      // enlever HTML
      t = t.replace(/<[^>]+>/g, '');
      // remplacer % selon langue
      t = t.replace(/%/g, lang === 'fr' ? ' pour cent' : ' percent');
      // enlever √©mojis (compat moderne)
      try {
        t = t.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}\u200D\uFE0F]/gu, '');
      } catch(_) {
        // fallback : retire les paires de suppl√©ments Unicode (la plupart des √©mojis)
        t = t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g, '');
      }
      // espaces propres
      t = t.replace(/\s{2,}/g,' ').trim();
      return t;
    }

    /* ========= Parole ========= */
    function speak(text) {
      if (!ttsEnabled || !("speechSynthesis" in window)) return;
      try {
        speechSynthesis.cancel();
        const cleaned = sanitizeForTTS(text);
        const u = new SpeechSynthesisUtterance(cleaned);
        const v = pickMaleVoice();
        if (v) u.voice = v;
        u.lang = v?.lang || (lang === "fr" ? "fr-FR" : "en-GB");
        u.rate = 0.95;
        u.pitch = 0.9;   // l√©g√®rement plus grave
        u.volume = 1.0;
        speechSynthesis.speak(u);
      } catch (e) { console.warn("TTS indisponible", e); }
    }
    if ("speechSynthesis" in window) speechSynthesis.onvoiceschanged = () => pickMaleVoice();

    /* ========= UI ========= */
    function updateLangUI() {
      const isFr = lang === "fr";
      title.textContent = isFr ? "üîÆ Michel ‚Äì Oracle IA" : "üîÆ Michel ‚Äì AI Oracle";
      langToggle.textContent = isFr ? "üåê Langue : Fran√ßais" : "üåê Language: English";
      ttsLabel.textContent = isFr ? (ttsEnabled ? "Voix activ√©e" : "Voix coup√©e")
                                  : (ttsEnabled ? "Voice on" : "Voice off");
      bubble.innerHTML = isFr ? instructions.fr : instructions.en;
      document.documentElement.lang = isFr ? "fr" : "en";
    }
    function updateTtsUI() {
      ttsToggle.setAttribute("aria-pressed", String(ttsEnabled));
      ttsIcon.textContent = ttsEnabled ? "üîä" : "üîà";
    }

    langToggle.addEventListener("click", () => {
      lang = lang === "fr" ? "en" : "fr";
      localStorage.setItem("michel_lang", lang);
      updateLangUI();
    });
    ttsToggle.addEventListener("click", () => {
      ttsEnabled = !ttsEnabled;
      localStorage.setItem("michel_tts_enabled", JSON.stringify(ttsEnabled));
      updateTtsUI(); updateLangUI();
      if (!ttsEnabled && "speechSynthesis" in window) speechSynthesis.cancel();
    });

    /* ========= Oracle ========= */
    function showAnswer() {
      if (navigator.vibrate) navigator.vibrate(15);
      const list = lang === "fr" ? answersFR : answersEN;
      const msg = list[Math.floor(Math.random() * list.length)];
      michel.classList.add("magic");
      setTimeout(() => michel.classList.remove("magic"), 600);
      bubble.style.opacity = 0;
      setTimeout(() => {
        bubble.innerHTML = msg;
        bubble.style.opacity = 1;
        bubble.classList.add("show");
        setTimeout(() => bubble.classList.remove("show"), 250);
        speak(msg);
      }, 120);
    }
    document.body.addEventListener("click", showAnswer);
    window.addEventListener("keydown", e => { if (e.code === "Space") { e.preventDefault(); showAnswer(); } });
  </script>
</body>
</html>
